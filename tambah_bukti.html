<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Upload</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><div class="brand-text"><h2>Upload Bukti</h2><p>Pembayaran</p></div></div><div class="container"><div class="card"><form id="f"><label>Karyawan</label><select id="kar" class="form-control"><option>-- Pilih --</option></select><label>Foto</label><input type="file" id="foto" accept="image/*" required class="form-control"><label>Keterangan</label><input type="text" id="ket" class="form-control"><button id="btn" class="btn">UPLOAD</button></form></div></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a><a href="pesanan.html" class="nav-item"><i class="fas fa-clipboard-list"></i><span>Pesanan</span></a><a href="data_karyawan.html" class="nav-item"><i class="fas fa-users"></i><span>Karyawan</span></a><a href="slip_gaji.html" class="nav-item active"><i class="fas fa-wallet"></i><span>Keuangan</span></a></div>
<script type="module">import{db}from"./config.js";import{collection,addDoc,getDocs,query,orderBy}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";const resize=(f)=>new Promise(r=>{const rd=new FileReader();rd.readAsDataURL(f);rd.onload=e=>{const i=new Image();i.src=e.target.result;i.onload=()=>{const c=document.createElement('canvas'),m=600,s=m/i.width;c.width=m;c.height=i.height*s;c.getContext('2d').drawImage(i,0,0,c.width,c.height);r(c.toDataURL('image/jpeg',0.7))}}});(async()=>{const q=query(collection(db,"karyawan"),orderBy("nama"));const s=await getDocs(q);const k=document.getElementById('kar');k.innerHTML='<option value="">-- Pilih --</option>';s.forEach(d=>k.innerHTML+=`<option value="${d.data().nama}">${d.data().nama}</option>`)})();document.getElementById('f').onsubmit=async e=>{e.preventDefault();const btn=document.getElementById('btn');btn.innerText="...";btn.disabled=true;try{const f=document.getElementById('foto');const img=await resize(f.files[0]);await addDoc(collection(db,"bukti_gaji"),{nama_karyawan:document.getElementById('kar').value,foto:img,keterangan:document.getElementById('ket').value,timestamp:new Date()});alert("Berhasil!");window.location.href="bukti_pembayaran.html";}catch(er){alert(er.message);btn.innerText="UPLOAD";btn.disabled=false}}</script></body></html>
