<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Hitung</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><style>.input-group{position:relative;display:flex;align-items:center;margin-bottom:10px}.input-group span{position:absolute;left:15px;color:#555;font-weight:bold;z-index:10;font-size:0.8rem}.input-group input{padding-left:35px;width:100%}</style></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><h3>Hitung Gaji</h3></div><div class="container"><form id="f"><div class="card"><h4>Data</h4><label>Karyawan</label><select id="kar" class="form-control"><option>-- Pilih --</option></select><label>Ulos</label><select id="ulos" class="form-control"><option>-- Pilih --</option></select>
<label>Upah</label><div class="input-group"><span>Rp</span><input type="number" id="upah" readonly class="form-control" style="background:#eee"></div>
<label>Jumlah</label><input type="number" id="jml" class="form-control" placeholder="">
<label>Pakan (Per Lbr)</label><div class="input-group"><span>Rp</span><input type="number" id="pakan" value="" class="form-control"></div>
</div><div class="card"><h4>Potongan</h4><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
<div class="input-group"><span>Rp</span><input type="number" id="p1" placeholder="Air" class="form-control"></div>
<div class="input-group"><span>Rp</span><input type="number" id="p2" placeholder="Wifi" class="form-control"></div>
<div class="input-group"><span>Rp</span><input type="number" id="p3" placeholder="Stell" class="form-control"></div>
<div class="input-group"><span>Rp</span><input type="number" id="p4" placeholder="Lain" class="form-control"></div>
</div></div><div class="card" style="background:#e3f2fd;text-align:center"><h2 id="tot" style="color:#0d47a1">Rp 0</h2><button type="button" id="cal" class="btn" style="background:orange">HITUNG</button></div><button id="sv" class="btn" style="margin-top:15px">SIMPAN</button></form></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i>Home</a><a href="pesanan.html" class="nav-item"><i class="fas fa-clipboard-list"></i>Pesanan</a><a href="data_karyawan.html" class="nav-item"><i class="fas fa-users"></i>Karyawan</a><a href="slip_gaji.html" class="nav-item active"><i class="fas fa-wallet"></i>Keuangan</a></div>
<script type="module">import{auth,db}from"./config.js";import{collection,getDocs,addDoc,query,orderBy}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
let um={}, km={}; const num=v=>Number(v)||0; const fmt=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(n);
onAuthStateChanged(auth,u=>{if(!u)window.location.href='login.html';else l()});
async function l(){const u=await getDocs(query(collection(db,"ulos"),orderBy("nama")));const k=await getDocs(query(collection(db,"karyawan"),orderBy("nama")));const su=document.getElementById('ulos'), sk=document.getElementById('kar');u.forEach(d=>{const dt=d.data();su.innerHTML+=`<option value="${dt.nama}">${dt.nama}</option>`;um[dt.nama]=dt.upah||0;});k.forEach(d=>{const dt=d.data();sk.innerHTML+=`<option value="${dt.nama}">${dt.nama}</option>`;km[dt.nama]=dt;});}
document.getElementById('ulos').onchange=function(){document.getElementById('upah').value=um[this.value]||0};
document.getElementById('cal').onclick=()=>{const t=(num(document.getElementById('upah').value)*num(document.getElementById('jml').value))-(num(document.getElementById('pakan').value)*num(document.getElementById('jml').value))-(num(document.getElementById('p1').value)+num(document.getElementById('p2').value)+num(document.getElementById('p3').value)+num(document.getElementById('p4').value));document.getElementById('tot').innerText=fmt(t);document.getElementById('tot').dataset.val=t;};
document.getElementById('f').onsubmit=async e=>{e.preventDefault();const btn=document.getElementById('sv');btn.innerText="...";btn.disabled=true;try{const kn=document.getElementById('kar').value;const d={nama_karyawan:kn,nama_ulos:document.getElementById('ulos').value,jumlah:num(document.getElementById('jml').value),pakan:num(document.getElementById('pakan').value)*num(document.getElementById('jml').value),pot_air:num(document.getElementById('p1').value),pot_wifi:num(document.getElementById('p2').value),pot_stell:num(document.getElementById('p3').value),pot_lain:num(document.getElementById('p4').value),gajiBersih:num(document.getElementById('tot').dataset.val),timestamp:new Date()};if(km[kn]){d.rekening=km[kn].rekening;d.bank=km[kn].bank;d.nama_rekening=km[kn].nama_rekening;d.foto_qris=km[kn].foto_qris;}await addDoc(collection(db,"gaji"),d);alert("Berhasil!");window.location.href="slip_gaji.html";}catch(er){alert(er.message);btn.innerText="SIMPAN";btn.disabled=false;}}</script></body></html>
