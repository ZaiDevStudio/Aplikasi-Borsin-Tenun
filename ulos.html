<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Galeri</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><div class="brand-text"><h2>Galeri Ulos</h2><p>Stok</p></div></div><div class="container"><input type="text" id="src" class="form-control" placeholder="Cari..."><div id="list"><p style="text-align:center">Memuat...</p></div></div><div id="imgModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;" onclick="this.style.display='none'"><img id="imgC" style="max-width:95%;border:2px solid white;border-radius:5px"></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item active"><i class="fas fa-home"></i><span>Home</span></a><a href="pesanan.html" class="nav-item"><i class="fas fa-clipboard-list"></i><span>Pesanan</span></a><a href="data_karyawan.html" class="nav-item"><i class="fas fa-users"></i><span>Karyawan</span></a><a href="slip_gaji.html" class="nav-item"><i class="fas fa-wallet"></i><span>Keuangan</span></a></div>
<script type="module">import{auth,db}from"./config.js";import{collection,getDocs,query,orderBy,doc,deleteDoc,getDoc}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";const fmt=n=>new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',minimumFractionDigits:0}).format(n);
window.view=(s)=>{document.getElementById('imgModal').style.display="flex";document.getElementById('imgC').src=s};
onAuthStateChanged(auth,async u=>{if(u){const d=await getDoc(doc(db,"users",u.uid));load(d.exists()&&d.data().role==='admin')}else window.location.href='login.html'});
let all=[]; async function load(adm){const s=await getDocs(query(collection(db,"ulos"),orderBy("timestamp","desc")));all=[];s.forEach(d=>all.push({id:d.id,d:d.data(),adm}));rend(all);}
function rend(ls){const l=document.getElementById('list');l.innerHTML='';ls.forEach(i=>{const dt=i.d;l.innerHTML+=`<div class="data-item"><div class="img-box"><img src="${dt.foto}" class="data-img" onclick="view('${dt.foto}')"><button onclick="view('${dt.foto}')" class="btn-mini" style="background:#17a2b8">ğŸ‘ï¸</button></div><div class="data-info"><h4>${dt.nama}</h4><p>Stok: ${dt.stock} | ${fmt(dt.harga)}</p></div>${i.adm?`<div class="admin-actions"><a href="tambah_data_ulos.html?id=${i.id}" class="btn-mini" style="background:orange">âœï¸</a><button onclick="del('${i.id}')" class="btn-mini" style="background:red">ğŸ—‘ï¸</button></div>`:''}</div>`})}
document.getElementById('src').oninput=e=>{const k=e.target.value.toLowerCase();rend(all.filter(i=>i.d.nama.toLowerCase().includes(k)))};
window.del=async i=>{if(confirm("Hapus?")){await deleteDoc(doc(db,"ulos",i));location.reload()}}</script></body></html>
