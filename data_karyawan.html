<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Karyawan</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><div class="brand-text"><h2>Data Karyawan</h2><p>Tim Produksi</p></div></div><div class="container"><input type="text" id="src" class="form-control" placeholder="Cari..."><div id="list"><p style="text-align:center">Memuat...</p></div></div><div id="imgModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;" onclick="this.style.display='none'"><img id="imgC" style="max-width:95%;border:2px solid white;border-radius:5px"></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a><a href="pesanan.html" class="nav-item"><i class="fas fa-clipboard-list"></i><span>Pesanan</span></a><a href="data_karyawan.html" class="nav-item active" style="color:#800000;font-weight:bold"><i class="fas fa-users"></i><span>Karyawan</span></a><a href="slip_gaji.html" class="nav-item"><i class="fas fa-wallet"></i><span>Keuangan</span></a></div>
<script type="module">import{auth,db}from"./config.js";import{collection,getDocs,query,orderBy,doc,deleteDoc,getDoc}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
window.view=(s)=>{document.getElementById('imgModal').style.display="flex";document.getElementById('imgC').src=s};window.cp=t=>{navigator.clipboard.writeText(t).then(()=>alert("Disalin!"))};
onAuthStateChanged(auth,async u=>{if(u){const d=await getDoc(doc(db,"users",u.uid));load(d.exists()&&d.data().role==='admin')}else window.location.href='login.html'});
let all=[]; async function load(adm){const s=await getDocs(query(collection(db,"karyawan"),orderBy("nama")));all=[];s.forEach(d=>all.push({id:d.id,d:d.data(),adm}));rend(all);}
function rend(ls){const l=document.getElementById('list');l.innerHTML='';ls.forEach(i=>{const dt=i.d;let wa='#';if(dt.hp)wa=`https://wa.me/${dt.hp.replace(/\D/g,'').replace(/^0/,'62')}`;const an=dt.nama_rekening?`<br><small>(A.n ${dt.nama_rekening})</small>`:'';l.innerHTML+=`<div class="data-item"><div class="img-box"><img src="${dt.foto}" class="data-img" onclick="view('${dt.foto}')"><button onclick="view('${dt.foto}')" class="btn-mini" style="background:#17a2b8">ğŸ‘ï¸</button></div><div class="data-info"><h4>${dt.nama}</h4><a href="${wa}" class="btn-mini" style="background:#25D366;display:inline-block;width:auto;padding:3px 8px;margin-bottom:5px;">Chat WA</a><div style="font-size:.8rem;background:#f5f5f5;padding:5px;border-radius:5px;">${dt.bank} - <strong>${dt.rekening}</strong>${an} <i class="fas fa-copy" onclick="cp('${dt.rekening}')" style="color:maroon;cursor:pointer"></i></div></div>${i.adm?`<div class="admin-actions"><a href="tambah_karyawan.html?id=${i.id}" class="btn-mini" style="background:orange">âœï¸</a><button onclick="del('${i.id}')" class="btn-mini" style="background:red">ğŸ—‘ï¸</button></div>`:''}</div>`})}
document.getElementById('src').oninput=e=>{const k=e.target.value.toLowerCase();rend(all.filter(i=>i.d.nama.toLowerCase().includes(k)))};
window.del=async i=>{if(confirm("Hapus?")){await deleteDoc(doc(db,"karyawan",i));location.reload()}}</script></body></html>
