<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pesanan</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><div class="brand-text"><h2>Input Pesanan</h2><p>Order Masuk</p></div></div><div class="container"><div class="card"><form id="f"><label>Ulos</label><select id="ulos" class="form-control"><option>-- Pilih --</option></select><img id="prev" style="display:none;width:100px;margin:10px 0;border-radius:10px"><label>Jumlah</label><input type="number" id="jml" required class="form-control"><label>Karyawan</label><select id="kar" class="form-control"><option>-- Pilih --</option></select><button id="btn" class="btn">KIRIM</button></form></div></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a><a href="pesanan.html" class="nav-item active" style="color:#800000;font-weight:bold"><i class="fas fa-clipboard-list"></i><span>Pesanan</span></a><a href="data_karyawan.html" class="nav-item"><i class="fas fa-users"></i><span>Karyawan</span></a><a href="slip_gaji.html" class="nav-item"><i class="fas fa-wallet"></i><span>Keuangan</span></a></div>
<script type="module">import{db}from"./config.js";import{collection,addDoc,getDocs,query,orderBy}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";let um={}; (async()=>{const u=await getDocs(query(collection(db,"ulos"),orderBy("nama")));const k=await getDocs(query(collection(db,"karyawan"),orderBy("nama")));const su=document.getElementById('ulos'),sk=document.getElementById('kar');u.forEach(d=>{const dt=d.data();su.innerHTML+=`<option value="${dt.nama}">${dt.nama}</option>`;um[dt.nama]=dt.foto;});k.forEach(d=>{const dt=d.data();sk.innerHTML+=`<option value="${dt.nama}">${dt.nama}</option>`;});})();document.getElementById('ulos').onchange=function(){const i=document.getElementById('prev');if(um[this.value]){i.src=um[this.value];i.style.display='block'}else i.style.display='none'};document.getElementById('f').onsubmit=async e=>{e.preventDefault();const btn=document.getElementById('btn');btn.innerText="...";btn.disabled=true;try{const d={nama_ulos:document.getElementById('ulos').value,jumlah:Number(document.getElementById('jml').value),nama_karyawan:document.getElementById('kar').value,foto:document.getElementById('prev').src||'',timestamp:new Date()};await addDoc(collection(db,"pesanan"),d);alert("Berhasil!");window.location.href="pesanan.html";}catch(er){alert(er.message);btn.innerText="KIRIM";btn.disabled=false}}</script></body></html>
