<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memuat Aplikasi...</title>
    <link rel="manifest" href="manifest.json">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
        
        body {
            background: linear-gradient(135deg, #800000 0%, #2c0000 100%); /* Maroon Gelap */
            height: 100vh; 
            margin: 0;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            color: white; 
            font-family: 'Poppins', sans-serif;
        }

        .logo-loader {
            width: 90px; 
            height: 90px; 
            border-radius: 50%; 
            border: 3px solid #D4AF37; /* Emas */
            object-fit: cover; 
            background: white; 
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); } 
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); } 
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); } 
        }

        .spinner {
            width: 40px; 
            height: 40px; 
            border: 4px solid rgba(255,255,255,0.2);
            border-top: 4px solid #D4AF37; 
            border-radius: 50%;
            animation: spin 1s linear infinite; 
            margin-bottom: 15px;
        }

        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        p { font-size: 0.9rem; letter-spacing: 2px; opacity: 0.8; }
    </style>
</head>
<body>
    
    <img src="borsin.png" class="logo-loader" alt="Logo">
    
    <div class="spinner"></div>
    <p>SI-BORSIN</p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        // 1. KONFIGURASI FIREBASE (MANDIRI)
        const firebaseConfig = {
            apiKey: "AIzaSyAXM4yJgh9F7ajGQApB-Ux1itQ_3pkik_o",
            authDomain: "borsin-tenun-app.firebaseapp.com",
            projectId: "borsin-tenun-app",
            storageBucket: "borsin-tenun-app.firebasestorage.app",
            messagingSenderId: "718889934564",
            appId: "1:718889934564:web:c28a073e261d6783d096f1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // 2. CEK STATUS LOGIN (PENGALIHAN OTOMATIS)
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Jika User Ada -> Masuk Dashboard
                window.location.href = 'dashboard.html';
            } else {
                // Jika User Tidak Ada -> Masuk Login
                window.location.href = 'login.html';
            }
        });

        // 3. AKTIFKAN MODE OFFLINE (PWA)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Aplikasi Siap Offline'))
                .catch(err => console.log('Gagal Service Worker', err));
        }
    </script>
</body>
</html>
