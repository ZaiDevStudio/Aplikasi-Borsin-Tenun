<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pesanan</title><link rel="stylesheet" href="style.css?v=FINAL"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></head><body>
<div class="navbar"><a href="dashboard.html" class="nav-btn"><i class="fas fa-arrow-left"></i></a><div class="brand-text"><h2>Pesanan</h2><p>Order</p></div></div><div class="container"><div id="list"><p style="text-align:center">Memuat...</p></div></div><div id="imgModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.9);justify-content:center;align-items:center;" onclick="this.style.display='none'"><img id="imgC" style="max-width:95%;border:2px solid white;border-radius:5px"></div><div class="bottom-nav"><a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i>Home</a><a href="pesanan.html" class="nav-item active" style="color:#800000;font-weight:bold"><i class="fas fa-clipboard-list"></i>Pesanan</a><a href="data_karyawan.html" class="nav-item"><i class="fas fa-users"></i>Karyawan</a><a href="slip_gaji.html" class="nav-item"><i class="fas fa-wallet"></i>Keuangan</a></div>
<script type="module">import{auth,db}from"./config.js";import{collection,getDocs,query,orderBy,doc,deleteDoc,getDoc}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";import{onAuthStateChanged}from"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
window.view=(s)=>{document.getElementById('imgModal').style.display="flex";document.getElementById('imgC').src=s};
onAuthStateChanged(auth,async u=>{if(u){const d=await getDoc(doc(db,"users",u.uid));load(d.exists()&&d.data().role==='admin')}else window.location.href='login.html'});
async function load(adm){const s=await getDocs(query(collection(db,"pesanan"),orderBy("timestamp","desc")));const l=document.getElementById('list');l.innerHTML='';if(s.empty)l.innerHTML='<p style="text-align:center">Kosong</p>';s.forEach(d=>{const dt=d.data();const img=dt.foto?`<div class="img-box"><img src="${dt.foto}" class="data-img" onclick="view('${dt.foto}')"><button onclick="view('${dt.foto}')" class="btn-mini" style="background:#17a2b8">ğŸ‘ï¸</button></div>`:'';l.innerHTML+=`<div class="data-item">${img}<div class="data-info"><h4>${dt.nama_ulos}</h4><p>Jml: ${dt.jumlah} | ${dt.nama_karyawan}</p></div>${adm?`<div class="admin-actions"><button onclick="del('${d.id}')" class="btn-mini" style="background:red;width:30px;border-radius:50%">ğŸ—‘ï¸</button></div>`:''}</div>`})}
window.del=async i=>{if(confirm("Hapus?")){await deleteDoc(doc(db,"pesanan",i));location.reload()}}</script></body></html>
